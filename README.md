# Bumblebee Voice Assistant (Hyprland, Bash Orchestrator)

A simple Siri-style assistant for Linux/Hyprland that uses a Bash orchestrator, a small Python recorder with VAD, and lightweight YAD HTML views. Speech-to-text runs on Groq Whisper, responses come from the Mistral API, and audio playback uses ALSA.

## Overview
- Listening is handled by `vad_record.py` (webrtcvad) and auto-stops on silence.
- STT uses Groq Whisper via a small Bash script.
- LLM replies are generated by Mistral Chat Completions.
- TTS uses Groq TTS; audio is played with `aplay`.
- UI is a minimal YAD popup rendered from simple HTML (no heavy frameworks).

## Architecture
- `scripts/assistant.sh`: Main orchestrator. Coordinates UI, recording, STT, LLM, and TTS.
- `scripts/vad_record.py`: Voice activity detection + recording to `tmp/query.wav`.
- `scripts/stt.sh`: Sends `tmp/query.wav` to Groq STT, prints JSON with recognized text.
- `scripts/tts.sh`: Calls Groq TTS API, writes `tmp/tts_output.wav`.
- `scripts/env.sh`: Exports API keys consumed by the scripts.
- `ui/*.html` + `ui/*.css`: YAD-rendered HTML views for Listening/Processing/Reply.
- `tmp/`: Scratch directory for audio files and transient outputs.

## Requirements
- Linux with a working microphone (Hyprland optional).
- System packages: `yad`, `jq`, `curl`, `alsa-utils` (`aplay`).
- Python 3.9+ with venv.
- Runtime library: `portaudio` (Arch package providing `libportaudio.so` required by `sounddevice`).

## Python Dependencies
Defined in `requirements.txt`:
- `webrtcvad==2.0.10`
- `sounddevice>=0.4.6`
- `numpy>=1.21`
- `setuptools>=60` (provides `pkg_resources` used by some deps)

## Setup
```zsh
# 1) Create and activate a virtual environment
python3 -m venv .venv
source .venv/bin/activate

# 2) Install Python dependencies
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt

# 3) Install PortAudio runtime for sounddevice (Arch Linux)
sudo pacman -Syu --noconfirm
sudo pacman -S --noconfirm portaudio

# 4) Ensure YAD and ALSA utilities are installed (Arch Linux)
sudo pacman -S --noconfirm yad jq curl alsa-utils

# Alternatively, using paru (AUR helper)
# paru -S yad jq curl alsa-utils portaudio
```

## Configuration
Create or edit `scripts/env.sh` with your API keys (do not commit secrets):
```bash
export GROQ_API_KEY="gsk_..."      # Groq (STT & TTS)
export MISTRAL_API_KEY="sk_..."    # Mistral (LLM)
```
`assistant.sh` sources this file at startup.

## Usage
```zsh
# Make scripts executable
chmod +x scripts/*.sh

# Start the assistant (from repo root)
scripts/assistant.sh
```
Flow (one-shot by default):
1. Shows “Listening…” when the recorder is ready.
2. Records speech and stops automatically on silence.
3. Switches to “Processing…” while transcribing and generating a reply.
4. Displays “You” and “Bumblebee” messages and plays TTS audio.
5. Exits when done. Re-run to start again.

## Exit Phrases (planned)
Support for voice-controlled termination (e.g., “stop listening”, “exit assistant”, “go to sleep”) is planned. Current behavior is single run; continuous loop functionality can be enabled in `assistant.sh` in a future update.

## Troubleshooting
- Invalid API key: ensure `scripts/env.sh` is sourced and that `stt.sh` uses `GROQ_API_KEY` (not `GROK_API_KEY`).
- `ModuleNotFoundError: pkg_resources`: install `setuptools` (already included in `requirements.txt`).
- No audio playback: verify `aplay` exists and your user can access the audio device.
- STT returns empty: check that `tmp/query.wav` was created; microphone input and permissions.
- Recorder errors: make sure `libportaudio2` is installed and that the Python venv is active.

## Project Structure
```
btw/
├── README.md
├── assets/
├── scripts/
│   ├── assistant.sh
│   ├── env.sh
│   ├── stt.sh
│   ├── tts.sh
│   └── vad_record.py
├── tmp/
│   ├── query.wav
│   └── tts_output.wav
└── ui/
	├── ass2.css
	├── assistant.css
	├── listening.html
	├── processing.html
	└── reply.html
```

## Notes
- Keep `scripts/env.sh` out of version control or use a secrets manager.
- YAD window geometry/position can be tuned in the scripts for your setup.
- If you prefer PipeWire tooling, you can swap `aplay` for `pw-play` (with minor script changes).
