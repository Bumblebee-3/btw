<p align="center">
  <img src="ui/assets/bee.png" alt="Bumblebee Trusts Wikipedia" width="180">
</p>


# Bumblebee Trusts Wikipedia (BTW)

A simple Siri-style assistant for Linux/Hyprland made using speech-to-text from Groq Whisper,and the responses come from the Mistral API.

## Overview
- Listening is handled by `vad_record.py` (webrtcvad) and auto-stops on silence.
- STT uses Groq Whisper via a small Bash script.
- LLM replies are generated by Mistral Chat Completions.
- TTS uses Groq TTS; audio is played with `aplay`.
- UI is a minimal YAD popup rendered from simple HTML (no heavy frameworks).


## Requirements
- Linux with a working microphone.
- System packages: `yad`, `jq`, `curl`, `alsa-utils` (`aplay`).
- Python 3.9+ with venv.
- Runtime library: `portaudio` (Arch package providing `libportaudio.so` required by `sounddevice`).
 - Polkit agent for privileged actions: `polkit-gnome` (or `polkit-kde-agent`, `lxqt-policykit`).

## Python Dependencies
Defined in `requirements.txt`:
- `webrtcvad==2.0.10`
- `sounddevice>=0.4.6`
- `numpy>=1.21`
- `setuptools>=60` (provides `pkg_resources` used by some deps)

## Setup
```zsh
# 1) Create and activate a virtual environment
python3 -m venv .venv
source .venv/bin/activate

# 2) Install Python dependencies
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt

# 3) Install PortAudio runtime for sounddevice (Arch Linux)
sudo pacman -Syu --noconfirm
sudo pacman -S --noconfirm portaudio

# 4) Ensure YAD and ALSA utilities are installed (Arch Linux)
sudo pacman -S --noconfirm yad jq curl alsa-utils

# Alternatively, using paru (AUR helper)
# paru -S yad jq curl alsa-utils portaudio
```

## Configuration
Create or edit `scripts/env.sh` with your API keys (do not commit secrets):
```bash
export GROQ_API_KEY="gsk_..."      # Groq (STT & TTS)
export MISTRAL_API_KEY="sk_..."    # Mistral (LLM)
export GEMINI_API_KEY="AIza..."     # Google Gemini (embeddings for command matching)
```
`assistant.sh` sources this file at startup.

If you plan to run privileged commands (e.g., package updates), ensure a polkit agent is running:
```zsh
sudo pacman -S polkit-gnome   # or polkit-kde-agent, lxqt-policykit
```

## Usage
```zsh
# Make scripts executable
chmod +x scripts/*.sh

# Start the assistant (from repo root)
scripts/assistant.sh
```

### System Command Execution (Safe, Registry-Based)
- The assistant executes pre-approved system commands via semantic matching (Google Gemini embeddings).
- Only commands in `scripts/commands.json` are eligible. Each entry includes:
	- `id`, `category`, `description`, `dangerous`
	- `examples` (paraphrases used for matching)
	- `parameters` metadata (`value`, `delta` for brightness/volume)
	- `shell_command_template` (deterministic; no LLM-generated shell)
- Embeddings are cached in `scripts/commands_cache.json` to avoid recomputation every run.
- Safety:
	- No dynamic command construction; templates substitute only safe integers.
	- `dangerous: true` shows a YAD confirmation with the exact command.
	- The assistant speaks the intent first (e.g., “Updating system packages.”) then executes.

Examples
```zsh
# CLI test without the full assistant
python scripts/commands.py --plan "increase brightness"
python scripts/commands.py --exec-id brightness_up
```

System updates (listing + polkit + progress)
```zsh
# Show available updates (Official, AUR, Flatpak), confirm, then update with progress
scripts/syst_upd.sh

# Voice command examples (through the assistant):
# "system update", "update packages", "update my system packages", "apply updates"
```

Dependencies for updates
```zsh
# Official updates listing requires pacman-contrib (checkupdates)
sudo pacman -S pacman-contrib

# Optional AUR helper for AUR updates
paru -S yay  # or install paru itself

# Optional Flatpak support
sudo pacman -S flatpak
```

Polkit pre-auth (focus fix)
- To prevent the YAD progress window from covering the polkit password dialog, the update scripts pre-auth with `pkexec true` before opening YAD.
- Ensure a polkit agent is running (e.g., `polkit-gnome`, `polkit-kde-agent`, `lxqt-policykit`).

## Project Structure
```
btw/
├── README.md
├── scripts/
    ├── assistant.sh
    ├── env.sh
    ├── stt.sh
    ├── tts.sh
    ├── vad_record.py
    ├── commands.py
    ├── matcher.py
    ├── embeddings.py
    ├── commands.json
    ├── arch_update.sh
    ├── syst_upd.sh
    └── commands_cache.json (generated)
├── tmp/
    ├── query.wav
    └── tts_output.wav
└── ui/
	├── assets/
	├── ass2.css
	├── assistant.css
	├── listening.html
	├── processing.html
	└── reply.html




